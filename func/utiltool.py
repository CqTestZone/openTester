# -*- coding: utf-8 -*-
import gzip
import hashlib
import hmac
from StringIO import StringIO
import random
import xlrd


def gzdecode(data):
    compressedstream = StringIO(data)
    gziper = gzip.GzipFile(fileobj=compressedstream)
    data2 = gziper.read()
    return data2


def random_str(len):
    str = ""
    for i in range(len):
        str += random.choice("1234567890")
    return str


def create_signature(token, str):
    return hmac.new(token, str, hashlib.sha1).digest().encode('base64').rstrip()


def get_request_params_list(param_values_file, testcase):
    doc = xlrd.open_workbook(param_values_file)

    table = doc.sheet_by_index(0)
    rows = table.nrows
    col = table.ncols

    keys = []
    param_list = []
    for i in range(rows):
        if i == 0:
            keys=table.row_values(i,1,col)
            continue

        if testcase == table.cell_value(i, 0):
            param_dict = {}
            for key in keys:
                param_dict[key] = table.cell_value(i, keys.index(key)+1)
            param_list.append(param_dict)

    return param_list
